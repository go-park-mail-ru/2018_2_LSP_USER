language: go
go:
- 1.11
before_script:
- sudo apt-get install -qq sshpass
script: 
after_success:
- sshpass -p $SSH_PASS ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST rm ~/server/user
- sshpass -p $SSH_PASS scp -rp -o stricthostkeychecking=no * $SSH_USER@$SSH_HOST:~/server/user
- sshpass -p $SSH_PASS ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST docker
  build -t user-server ~/server/user
- sshpass -p $SSH_PASS ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST docker
  stop user
- sshpass -p $SSH_PASS ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST docker
  run -e "DB_HOST=postgres" -e "DB_USER=$DB_USER" -e "DB_PASS=$DB_PASS" -e "DB_DB=$DB_DB" -e "AVATARS_PATH=/go/src/github.com/go-park-mail-ru/2018_2_LSP/avatars/"
  -d --link postgres:postgres --publish 5050:8080 --name user --rm user-server
env:
  global:
  - secure: DQXc39Apaw/FXkfgUJUQLvSAHpxXGjd2IabyxTrJ2sw3Cf/yTd7HewqlRsdiE1YcGU9qXuXVBEIckhdViPTlBTXzp3uzMJ4dn6Y6tt1FhuH/MMGPmtC2ryjUrLZ6WzwxScba5UyPKif8MpJyXwPkGO4yZPEn0tkA7ES2m4bPxY5bNcOde0RN7zdHYa2AYvI90zhs+xzSXe0QEtmBK7EpNDe+Ff3MzXfu/vsJUfb56IvWavtdxK6G63QmEgOGlw2t4Woz/lWnII3j+uPO6fo2Kpz9AOEXlw7KYYA0/N0UcmKlhbEHeAvY6CTizfvyTq7BXerW7VD+DoDLQfO8a2ngykD32VrnKQ5VQDGGdfAD4QNpB+UfdsVo1uI5CtXpWjxJDy6SAa6al9ukHD1q6izhK3STJTekLW2+UJtwbOdDJG/J6Xdqwiy0mhKdp28HRn5NsUr+6CHxdTwEVaMuZNVNqAJsQhds0x8Ok8R/GcpiIFM01uIimkBZCDQvG4HPbCoC/pgLFNNMRayD6RVz0+h1yUCYXa1v/rz4eXuemlW47Y3c1GTlmGlVp/5uXiHce+ZSXHp4AfsCTGX5siLhwej1SDkjT8WOY7qnRAVnYhdjxusEOCbqeYHwSO/G9QSoiIMIG9dpELLs9BE2yphX4kQYeu7qGrHZ3tKhRODwPJfoVC8=
  - secure: F1s9Ezsx79i7b5+jMQtoFD6ZsxME6zh4ffNk19EDQkOYUk88L3cFX1mO6JyW3IM/NrtYOvKU4/yZk4qj8dz3UseBnXTB7vkSV+XuG4zj3NMJOAphAwrR87UzzRA9d3FXu1KuUiXTl/mVulAc8VYPSD28iKpMSuPf4awV89yI39rHN6N8RSEqzS2B6FTxiY8mLFt6b8f57SG+59G8QJ6+aApx/bupm+CNbQoQHlS+C9UjG7L5n/LoT5er2vt2q0WTX6epLxSiyAV9jqfdQKEVSwaYZBJTF6MnwAZghZIP0AflSAOeE0L2WE2flzf/1DBZP4Qq0hBB/o4Kaz6hUWkyF7VQTdOpwL20d33zCUjE7lGAHB6qOyA+VFSDwLfCHr/hJN50ZpcAPPaYTFD6P7pXL++Mh+raGHKz1uRcHl5MvcBUMUFVEDKhfNmLk4ZfBg5Zxy0LjHqujU4gGS7NvvH5cBm4lu2bq14RcsxI09UdDnMochblshQD4iIdlThH2XjZZlVyXOckZE4a494fZ6Y0NZmGFDIP40ap/7Txp+FkWQdkF34CTqrlIxZGmty4d/q0npIEVFaLFMW+OSaNnz1NlkXW8hYMgtqUnLObVlgfOFijFm6cMQ3Rj2jiO63pk4Bcr1ehCaxBpay/tvpXJDU0pxtoxpOKsQwb8bMbT4Ht83o=
  - secure: A4muRKf0xsoSVmzC/lHczbheJsir5FG3zJjnm9kUWaF/Do1e0iDfihotBth1OZnaTZ5/27o2whZaA5jxGxJlEjrwIUTdwYt7UKA/USQvWwdeF5qd5iyJp8IbvMFo2jR8tuwvVKy2UyBqzeT/evHgG/sENudE1EENrMo9pmT/W+EicOyba9n0ia/lWaSORGx77lqVUg/sy7mnlToilElwDUHqMUhyvrFnQqY9jNIx1t5IpexHNxdtHCl3VmsfEHjNeMmzWj1jiNSyaERskMZnqr93t+Yf4NVD+6mJ3CFk5hyr2yGxDZsq/vkPjX3wpWOCVP6SpNpDJ8x+6bEO2QHkIjBOcdPAwFLSy3y1eqyaQyA09hRn6kdrGw8DV0x0e9AACCsWwX3fHBhidZ+ccTbwDOb2V4RZhUaYf9oT1BVKaTUtYfIC6LFUxS8ol8ltm694y9I9DjL+lE1TId7IPsD8/8/31lEm87wDw0gNCOqdDsx3xuEVbX7UY5A3ZgoKVjwujH1vvVWCks4fwdNwCUrs8F1GOb7THuDfyAn5luEnHajyNJywr3Nkok7FO8lPfNFmS7RuDs+HMs3dJWHZa8ByevX2gv27PKXPCo2GfPvMGuEx8SepL/PQChKaqu9iURzwOURhPwowZ+ugGVaPgZ8Sbmyq7EOrLUZvIMX1WJC5FwI=
  - secure: ncrNVegN6WaYOYdne78upiYdwCPkzKarGsmew1SXzoskLPfqsYvJ0T52yc3pZTJyhXu1O7FmaQQT6/v2Q3ZTxsmkxf3gvtCXO8TRwDKhDcAqhu57mywUr8dVdLMfTXJ/C10o2tOpZ2Q58h1rDdPPPpX53QuvYawmqdnTmUZTxYo33yGWVMdiIBLaswlQOZyU/xLav/eHZeLojrxg6fwQmQgoSLSFPkwRMx94l0Bq/43ZYneCIGKZcA/2btRTfweE1j8Cnwtfqy3kbog4XzF3AXRRnJjLrYOg95tWCyDzw8MUYF3lRkxwCPnx0OMrA1SEpzwUSAx69UQ4WyJ6dKpIc24+UirHqQ7O5WmRP6+m9XFetzMs8sH1GRrCp6KPcUnXJLB9+JrfeCSqhXxN9R7+k0XsonCkXV8Fisbm9DmyzYXkPQzvyo6dqHs6KvdV7ZRg/dgX4b6j7GGShz9RzZd6BMWI/08Oqs8uiswQHEQBKtfV4QJvaewxWRtpoMM6hlNKJL3t3p/LZiM9o8IUDDa2rHF3zTgK2BKCagsB04y54UuZYiuY4WO8Odl/37g0OPOJa3KyqU8SBmi9Cj9EKikZoM/pLCJ1CzDc/w2mlg5DAGUx8NmLNV4u+wnl4vce0LU4nQ7HVzzyxcSFLofkgIuVcrX/ORf1OjT15FwDJvyzh8U=
  - secure: OQ5TYpU770V9G6KqmfxoWIxlIeGrmIIXjwYNmchpiZXnTI1hgVam99g925PUrJSD8g1t6k7jFzBvncEQDYhucXS7cu/+Bw38jE4hVExZZ9Hjd646TP6ObhkddwgdgELO9gW6Om+jrzsDeo0WLtKoGfPco72BxAmlvKX/1IBfurs6ADhKicG9coNynVqMoz627L1uArzJ8J8szvyEEqtwQCOyGUtAYVDrwyuaN2sryfPwBQJ+X15sHFF+9++LkqOrIfLa5gpnylUQX0FiY9D3MIBnXQFJHX0ikCLDiMG3oUiDnvquR+8BDQSOF4+tboGKT5qBNAnzI1AC14t2PuR/pgZH+mb6o6KBWvHO0uo6+D/aUPpjNT31B9Oymt6ovRHSLjyhnw2LiAAFp/35PXqIrHzDJjkqyf9ei7x1THmqfa56HKNhEytqw0A1JiUQ8Vvo0cFqXEAr4cFlT/ll7TJmz3UeQZWwNXxS4D0pE5txwXAomkb0p/b8dIgoILdQP7f1wSVAA6V/84sMtlDczM+sDgJR9dLe4BATSbQTha0OcUvwlVo86WmF7nwl1IQBicz8yvH7g7slagNMh0wT4t66B+9e+JpEfof73zTc/irGcW4kwHW42pQ0CmQFT5gQHCVTLsNF6sP3g9KcRB7stYQcjqO6+xDfbxptZY5mAMAbTNk=
  - secure: j/eZC8a6T7HrF6r3AjS7U2zldFk+xLpDicCwOV+6PrbuxR/ugNzUlT9qnK62cTDA1ISGypJqEhmJsdGdczR1FkvYk5IbPC8de7ze+zFU/Pn20nsaNMRdusv3kjnJDc2zP/JDaDFfJVTcWgj57HykNMF3AFNtQ21A/Pz0oST1BZ4+6fF8HUEpxvuZT1eeoertpT3jziOTJVoAjsahkrGy3/XsQPsfi9gPwUL3j4uZlzaCCv0+pViCbabcl/bRje6FtGpNMs8rUH/p0EEWRbwPrIddtdSeG7JMlT3oCmafNj9xcvE5UK/AUGEPgM4TVwggXulSIzHT7on4+/KWMLHKRAktBnru91nsz2Mum4Oeq01oeSPu8a6z33ji4u1ELF445QDh19NSjn/zm9TTekHoBdjNIzwSDyjCHw6bb4NTANLnZbFMBR44cs+6BcFJoS820O5K5OiQ5ZhoUknEcA6hL7LbpS0NCO2PKPgwUg5z1HlxJADsJGyKQtqxyWHJ+Kl6q+LeXFtUGevaSg6h5VxOSbTybAGOrxi1jNtilb8Au96qJKEQ6V5PIwRiQsKBneLu2pZMIV8LiYwXY+S7WJ4j/LyjZG8u2e4hlLrfYcoGVNlbaSg159ouzG1UiIsaaD6zAPyr7Y45Rtb70O3OZ7HMKqdURP7WPBQU7NKbRThPMb8=
